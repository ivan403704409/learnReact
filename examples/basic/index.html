<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>Basic Example</title>
    <link rel="stylesheet" href="../shared/css/base.css" />
  </head>
  <body>
    <div id="content"></div>

    <script src="../shared/thirdparty/es5-shim.min.js"></script>
    <script src="../shared/thirdparty/es5-sham.min.js"></script>
    <script src="../shared/thirdparty/console-polyfill.js"></script>
    <script src="../../build/react.js"></script>
    <script>
      // var ExampleApplication = React.createClass({
      //   render: function() {
      //     var elapsed = Math.round(this.props.elapsed  / 100);
      //     var seconds = elapsed / 10 + (elapsed % 10 ? '' : '.0' );
      //     var message =
      //       'React has been successfully running for ' + seconds + ' seconds.';

      //     return React.DOM.p(null, message);
      //   }
      // });

      // // Call React.createFactory instead of directly call ExampleApplication({...}) in React.render
      // var ExampleApplicationFactory = React.createFactory(ExampleApplication);

      // var start = new Date().getTime();
      // setInterval(function() {
      //   React.render(
      //     ExampleApplicationFactory({elapsed: new Date().getTime() - start}),
      //     document.getElementById('container')
      //   );
      // }, 50);



var CommentBox = React.createClass({
    // 在组件的生命周期中仅执行一次，用于设置初始状态
    getInitialState: function() {
        return {data: []};
    },
    onCommentSubmit: function(comment) {
        // 模拟提交数据
        comments.push(comment);

        var self = this;
        setTimeout(function() {
            // 动态更新state
            self.setState({data: comments});
        }, 500);
    },
    loadCommentsFromServer : function() {

        var self = this;
        setTimeout(function() {
            // 动态更新state
            self.setState({data: data});

        }, 2000);
    },
    // 当组件render完成后自动被调用
    componentDidMount: function() {

        this.loadCommentsFromServer();
        setInterval(this.loadCommentsFromServer, this.props.pollInterval);
    },
    render: function() {
        return (
            <div className="commentBox">
                <h1>Comments</h1>
                <CommentList data={this.state.data} />
                <CommentForm onCommentSubmit={this.onCommentSubmit} />
            </div>
        );
    }
});

var CommentForm = React.createClass({
    handleSubmit: function(e) {

        e.preventDefault();
        // e.returnValue = false;
        var author = this.refs.author.getDOMNode().value.trim();
        var text = this.refs.text.getDOMNode().value.trim();

        if(!text || !author) return;

        this.props.onCommentSubmit({author: author, text: text});

        // 获取原生DOM元素
        this.refs.author.getDOMNode().value = '';
        this.refs.text.getDOMNode().value = '';
    },
    render: function() {
        return (
            // 为元素添加submit事件处理程序
            // 用ref为子组件命名，并可以在this.refs中引用
            <form className="commentForm" onSubmit={this.handleSubmit}>
                <input type="text" placeholder="Your name" ref="author"/>
                <input type="text" placeholder="Say something..." ref="text"/>
                <input type="submit" value="Post"/>
            </form>
        );
    }
});


React.render(
    <CommentBox />,
    document.getElementById('content')
);
    </script>
  </body>
</html>
